name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Generate the gradle wrapper
        run: ./gradlew wrapper
      - name: Run tests
        run: ./gradlew test
      - name: Get version
        run: |
          while read line; do
            if [[ $line =~ ^version\ .+ ]]
            then
              version=${line:9}
              version=${version::-1}
              echo "VERSION=version" >> $GITHUB_ENV
              break
            fi
          done
        

      - name: Deploy to a Git Repo
        uses: RecraftedCivilization/push-to-other-repo@v1
        env:
          API_TOKEN_GIHUB=${{ secrets.api_token_github }}
        with:
         target-repository: RecraftedCivilizations/RecraftedVivilizations.github.io
	 src-directory: build/reports/tests/test
	 target-directory: Projects/${{ github.repository }}
	 username: RecraftedCI
	 email: recrafted-ci@recrafted-ci.com
	 commit-message: "chore: Upload new test results for version: ${{ env.VERSION }}"
